# platform-cli

Утилита для работы с `airSlate Platform`.

## Команды

#### `asp clone <repoName> [branch]`

Выполняет `git clone <repoName>` в папке `repos`.

Алиас: `cl`.

Примеры: `asp clone account-app`, `asp cl account-app develop`.

---

#### `asp checkout [branch]`

Делает переход всех репозиториев, указанных в `.asp/general.json` на указанную ветку.
Репозиторий удаляется из папки `repos`, если указанной ветки для него не существует.
Перед работай делает проверку на наличие изменений во всех репозиториях.

Если параметр `[branch]` не указан, то репозитории будут клонироватся по информации из файла `.asp/repos.json`, если такой имеется.

Алиас: `ch`.

Опции:
- `--concurrency`, `-c` - количество потоков, то есть `git` инстансов, запущенных одновременно. По умолчанию `3`.

- `--verbose`, `-v` - отображение более подробного вывода в консоль.

- `--save`, `-s` - сохраняет информацию о репозиториях в `.asp/repos.json`.

- `--clear` - удаляет файл `.asp/repos.json` и папку `repos`.

Примеры: `asp checkout develop`, `asp ch develop`.

---

#### `asp current-branches [--repoNames|-r]`

Отображает ветки, на которых находятся склонированные репозитории.

Примеры: `asp current-branches`, `asp-current-branches -r account-app -r address-book-app`.

---

#### `asp exec <command> [--repoNames|-r]`

Выполнит указанную команду в каждом склонированном репозитории.

Алиас: `ex`.

Примеры: `asp exec "git pull"`, `asp ex "git pull" -r account-app`.

---

#### `asp status [--repoNames|r]`

Отображает `git` статус для склонированных репозиториев.

Алиас: `st`.

Примеры: `asp status`, `asp st -r account-app`.

---

#### `asp link`

Линкует склонированные пакети в `node_modules`.

---

#### `asp link-by-yarn`

Использует `yarn` для линкования склонированных пакетов. Является альтернативой `asp link`.

---

#### `asp git-to-ver [timeAgo]`

Заменяет `git` ветки `latest` версиями пакетов, которые были опубликованы `timeAgo` времени назад.
По умолчанию, `timeAgo` равен `10m`, то есть, все пакеты, которые было опубликованы, как `latest`, раньше 10-ти минут назад, останутся с `git` ветками.

Возможные форматы `timeAgo` можно просмотреть [здесь](https://www.npmjs.com/package/parse-duration).

Опции:

- `--noReplace` - если вы хотите только просмотреть информацию о том какие пакеты получат новые версии, но не применять их.

Примеры: `asp git-to-ver`, `asp git-to-ver 1day`, `asp git-to-ver 1week --noReplace`.

---

#### `asp locale-audit-app [repoName] [localeFileName]`
- `repoName` - имя репозитория.
- `localeFileName` - имя файла переводов.

Команда проверяет пакет на соответствие локалей, расположенных в файле для этого пакета.

#### Применение:
В корне `front-platform` необходимо создать файл `locales-map.json`, где будут прописаны префиксы с соответствующими им функциями перевода:
```json
{
  "$g": "AS_CREATOR_",
  "$r": "AS_CREATOR_",
  "$s": "SUPPORT_",
  "$l": "",
  "$c": "AS_COMMON_"
}
```
Далее, необходимо склонировать пакет, для которого будет выполняться проверка.
Выполнить команду `asp locale-audit-app auth-app frontend` и в результате, будет сформирована папка `build-locales-audit`, в корне `front-platform`.
В этой папке будут сформированы два файла - `data-excess.json` и `data-included.json`.
В `data-excess.json` находятся локали, которых нет в "предполагаемом" файле переводов, а значит, они используются из другого файла и должны быть продублированы.
В файле `data-included.json` содержаться константы, которые используются в файле локалей и могут послужить для формирования нового файла, если такового нет.

---

#### `asp locale-audit-file [repoName] [localeFileName]`
- `repoName` - имя репозитория.
- `localeFileName` - имя файла переводов.

Команда проверяет файл переводов на актуальность констант, используемых в пакете.

#### Применение:
Аналогично `locale-audit-app`.
При выполнении условия "один пакет - один файл локалей", можно выполнить проверку на актуальность констант в пакете.
После выполнения формируется файл `data-excess.json` в котором содержаться лишние константы.

---

### Общие опции

`--logout` - запись логов в файл `asp-logs--*.txt`.
